@using Microsoft.AspNetCore.Hosting;
@using Microsoft.Extensions.FileProviders;
@using System.Globalization;
@using System.Net;

@inject IWebHostEnvironment environment

@model IDirectoryContents

@{
    ViewData["Title"] = "Home Page";
}

<table class="table caption-top">
    <caption>List of books</caption>
    <thead>
        <tr>
            <th><span>Name</span></th>
            <th class="text-end"><span class="pe-3">Length</span></th>
            <th><span class="ps-3">Last&nbsp;Modified</span></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var dir in this.Model.Where(x => x.IsDirectory))
        {
            <tr>
                <td><span><a href="/path/@HtmlEncode(dir.Name)">@Html.Raw(HtmlEncode(dir.Name))</a></span></td>
                <td colspan="2"></td>
            </tr>
        }

        @foreach (var file in this.Model.Where(x => !x.IsDirectory))
        {
            var path = file.PhysicalPath.Replace(this.environment.WebRootPath, string.Empty);
            <tr>
                <td><span><a href="/books/@HtmlEncode(file.Name)">@Html.Raw(HtmlEncode(file.Name))</a></span></td>
                <td><span class="float-end">@Html.Raw(HtmlEncode(file.Length.ToString("n0", CultureInfo.CurrentCulture)))</span></td>
                <td><span class="ps-3">@Html.Raw(@HtmlEncode(file.LastModified.ToString("yyyy-MM-dd hh:mm", CultureInfo.CurrentCulture)))</span></td>
            </tr>
        }
    </tbody>
</table>

@functions {
    private string HtmlEncode(string body)
    {
        return HtmlEncoder.Encode(body);
    }
}